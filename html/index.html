<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pesquisa de Satisfa√ß√£o</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #1e1e2f;
        color: #f8f9fa;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .container {
        width: 100%;
        max-width: 700px;
      }

      .choice {
        cursor: pointer;
        text-align: center;
        transition: transform 0.2s;
        border-radius: 12px;
        padding: 10px;
        margin: 10px 0;
      }

      .choice img {
        width: 80px;
        height: 80px;
        transition: transform 0.3s;
      }

      .choice:hover img,
      .choice.selected img {
        transform: scale(1.4);
      }

      .choice p {
        margin-top: 10px;
        transition: transform 0.3s, color 0.3s;
        font-weight: 500;
      }

      .choice.muitoInsatisfeito.selected p {
        color: #d32f2f;
        transform: scale(1.2);
      }
      .choice.insatisfeito.selected p {
        color: #f57c00;
        transform: scale(1.2);
      }
      .choice.neutro.selected p {
        color: #fbc02d;
        transform: scale(1.2);
      }
      .choice.satisfeito.selected p {
        color: #388e3c;
        transform: scale(1.2);
      }
      .choice.muitoSatisfeito.selected p {
        color: #2e7d32;
        transform: scale(1.2);
      }

      .canal-container label {
        margin-left: 5px;
        margin-right: 15px;
        font-weight: 500;
        color: #fff;
        cursor: pointer;
      }

      #enviarAvaliacao {
        margin-top: 40px;
        font-size: 16px;
      }

      .tela-agradecimento {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #1e1e2f;
        justify-content: center;
        align-items: center;
        text-align: center;
        font-size: 1.5rem;
        z-index: 9999;
      }

      @media (max-width: 800px) {
        .canal-container .d-flex {
          flex-direction: column !important;
          align-items: center;
        }
        .canal-container .form-check {
          margin-bottom: 10px;
        }
        .row.justify-content-center {
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          gap: 10px; /* espa√ßo entre os emojis */
        }

        .choice {
          flex: 0 0 90px; /* largura fixa dos emojis */
          text-align: center;
          margin: 5px;
        }

        .choice img {
          width: 80px;
          height: 80px;
          transition: transform 0.3s;
        }

        @media (max-width: 800px) {
          .choice {
            flex: 0 0 60px; /* menor no tablet */
          }
          .choice img {
            width: 50px;
            height: 50px;
          }
          .choice p {
            font-size: 0.8rem;
          }
        }

        @media (max-width: 576px) {
          .choice {
            flex: 0 0 35px; /* ainda menor no celular */
          }
          .choice img {
            width: 20px;
            height: 20px;
          }
          .choice p {
            font-size: 0.7rem;
          }
        }
      }
    </style>
  </head>
  <body>
    <!-- Tela de Avalia√ß√£o -->
    <div class="container py-5" id="tela-avaliacao">
      <h1 class="text-center mb-4">Pesquisa de Satisfa√ß√£o</h1>
      <h4 class="text-center mb-4 py-3">Avalie sua experi√™ncia</h4>

      <div class="row justify-content-center">
        <div
          class="col-6 col-sm-4 col-md-2 choice"
          data-column="muitoInsatisfeito"
        >
          <img src="/img/Vermelho-Raiva.png" alt="P√©ssimo" class="img-fluid" />
          <p>P√©ssimo</p>
        </div>
        <div class="col-6 col-sm-4 col-md-2 choice" data-column="insatisfeito">
          <img src="/img/Laranja-Ruim.png" alt="Ruim" class="img-fluid" />
          <p>Ruim</p>
        </div>
        <div class="col-6 col-sm-4 col-md-2 choice" data-column="neutro">
          <img src="/img/Amarelo-Neutro.png" alt="Neutro" class="img-fluid" />
          <p>Neutro</p>
        </div>
        <div class="col-6 col-sm-4 col-md-2 choice" data-column="satisfeito">
          <img src="/img/Verde-Bom.png" alt="Bom" class="img-fluid" />
          <p>Bom</p>
        </div>
        <div
          class="col-6 col-sm-4 col-md-2 choice"
          data-column="muitoSatisfeito"
        >
          <img src="/img/Verde-Otimo.png" alt="Muito Bom" class="img-fluid" />
          <p>Muito Bom</p>
        </div>
      </div>

      <div class="canal-container mt-4 text-center">
        <p>Canal de Divulga√ß√£o:</p>
        <div class="d-flex flex-wrap justify-content-center">
          <div class="form-check">
            <input
              type="radio"
              id="instagram"
              name="canal"
              value="instagram"
              class="form-check-input"
              checked
            />
            <label for="instagram" class="form-check-label">Instagram</label>
          </div>
          <div class="form-check">
            <input
              type="radio"
              id="radio"
              name="canal"
              value="radio"
              class="form-check-input"
            />
            <label for="radio" class="form-check-label">R√°dio</label>
          </div>
          <div class="form-check">
            <input
              type="radio"
              id="amigos/familiares"
              name="canal"
              value="amigos/familiares"
              class="form-check-input"
            />
            <label for="amigos/familiares" class="form-check-label"
              >Amigos/Familiares</label
            >
          </div>
        </div>
      </div>

      <div class="text-center">
        <button id="enviarAvaliacao" class="btn btn-success">
          Enviar Avalia√ß√£o
        </button>
      </div>
    </div>

    <!-- Tela de Agradecimento -->
    <div
      class="tela-agradecimento d-flex"
      id="tela-agradecimento"
      style="display: none !important"
    >
      <h2>üéâ Muito obrigado pelo seu feedback!</h2>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const choices = document.querySelectorAll(".choice");
        let avaliacaoSelecionada = null;

        choices.forEach((choice) => {
          choice.addEventListener("click", () => {
            choices.forEach((c) => {
              c.classList.remove("selected");
              c.classList.remove(
                "muitoInsatisfeito",
                "insatisfeito",
                "neutro",
                "satisfeito",
                "muitoSatisfeito"
              );
            });
            choice.classList.add("selected");
            choice.classList.add(choice.dataset.column);
            avaliacaoSelecionada = choice.dataset.column;
          });
        });

        function getCanalSelecionado() {
          const radios = document.getElementsByName("canal");
          for (const radio of radios) {
            if (radio.checked) return radio.value;
          }
          return "instagram";
        }

        document
          .getElementById("enviarAvaliacao")
          .addEventListener("click", () => {
            if (!avaliacaoSelecionada) {
              alert("Selecione uma avalia√ß√£o antes de enviar!");
              return;
            }

            const canal = getCanalSelecionado();
            const mappingEnum = {
              muitoInsatisfeito: "muito_insatisfeito",
              insatisfeito: "insatisfeito",
              neutro: "neutro",
              satisfeito: "satisfeito",
              muitoSatisfeito: "muito_satisfeito",
            };
            const avaliacaoEnum = mappingEnum[avaliacaoSelecionada];

            fetch(
              "https://pesquisa-satisfacao-925015353452.southamerica-east1.run.app/api/avaliacao",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  avaliacao: avaliacaoEnum,
                  canal: canal,
                }),
              }
            )
              .then(async (response) => {
                if (!response.ok)
                  throw new Error(`Erro HTTP ${response.status}`);
                await response.json();

                // MOSTRA APENAS A TELA DE AGRADECIMENTO
                document.getElementById("tela-avaliacao").style.display =
                  "none";
                document.getElementById("tela-agradecimento").style.display =
                  "flex";
              })
              .catch(() => {
                alert("Erro ao enviar avalia√ß√£o. Tente novamente mais tarde.");
              });
          });
      });
    </script>
  </body>
</html>
